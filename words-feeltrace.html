
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Feeltrace and calibrated words analysis &#8212; Emotion Transitions Analysis</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >let toggleHintShow = 'Click to show';</script>
    <script >let toggleHintHide = 'Click to hide';</script>
    <script >let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Calibrated words self-report analysis" href="calibrated-words.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Emotion Transitions Analysis</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Intro
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="feeltrace.html">
   Continuous self-report analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calibrated-words.html">
   Calibrated words self-report analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Feeltrace and calibrated words analysis
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/words-feeltrace.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fwords-feeltrace.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/words-feeltrace.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#module-definitions">
   Module definitions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-data">
   Import data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#single-participant">
   Single participant
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downsampling-the-continuous-annotation">
     Downsampling the continuous annotation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aggregating-by-taking-the-mean">
       Aggregating by taking the mean
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aggregating-by-taking-the-slope">
       Aggregating by taking the slope
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#joint-time-series-analysis">
     Joint time series analysis
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#granger-causality">
       Granger Causality
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#limitations">
         Limitations
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cointegration">
       Cointegration
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stationarity">
       Stationarity
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pearson-s-correlation">
       Pearson’s correlation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#var-model">
       VAR Model
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#training-and-validation-data">
         Training and validation data
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#fitting">
         Fitting
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#check-for-remaining-serial-correlation">
         Check for remaining serial correlation
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#forecasting">
         Forecasting
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#accuracy">
         Accuracy
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#all-participants">
   All participants
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#states">
     States
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Granger Causality
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Cointegration
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Pearson’s correlation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       VAR Model
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transitions">
     Transitions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Granger Causality
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Cointegration
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Pearson’s correlation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       VAR Model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#emotion-dynamics-analysis">
   Emotion dynamics analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-emotion-dynamics-features">
     Defining emotion dynamics features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-preprocessing-scaling">
     Data preprocessing: scaling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pairplot-analysis">
     Pairplot analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#d-scatterplot">
     3D scatterplot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#principal-component-analysis">
     Principal Component Analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#repeated-measures-analysis">
     Repeated Measures Analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gaussian-mixture-model">
     Gaussian Mixture Model
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="feeltrace-and-calibrated-words-analysis">
<h1>Feeltrace and calibrated words analysis<a class="headerlink" href="#feeltrace-and-calibrated-words-analysis" title="Permalink to this headline">¶</a></h1>
<p>Rubia Guerra</p>
<p>Last updated: Apr 16th 2022</p>
<p>TODO: Fix participant mappings (P2, P3… P20) -&gt; (P1…P16)</p>
<div class="section" id="module-definitions">
<h2>Module definitions<a class="headerlink" href="#module-definitions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">sio</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.api</span> <span class="kn">import</span> <span class="n">VAR</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.eval_measures</span> <span class="kn">import</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">aic</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn&quot;</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="import-data">
<h2>Import data<a class="headerlink" href="#import-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">=</span> <span class="s1">&#39;../EEG/data/p*&#39;</span><span class="p">):</span>
    <span class="n">feeltrace_data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;joystick.mat&#39;</span><span class="p">))</span>
    <span class="n">feeltrace_data_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    
    <span class="n">feeltrace_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">subject_filename</span> <span class="ow">in</span> <span class="n">feeltrace_data_files</span><span class="p">:</span>
        <span class="n">mat_contents</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">subject_filename</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">mat_contents</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">])</span>
        <span class="n">p_number</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;p\d+&#39;</span><span class="p">,</span> <span class="n">subject_filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_number</span>
        <span class="n">feeltrace_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="n">subject_data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;calibrated_words_calibrated_values.mat&#39;</span><span class="p">))</span>
    <span class="n">subject_data_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">timestamps_data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;calibrated_words_time*.mat&#39;</span><span class="p">))</span>
    <span class="n">timestamps_data_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    
    <span class="n">subjects_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">subject_filename</span><span class="p">,</span> <span class="n">timestamp_filename</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subject_data_files</span><span class="p">,</span> <span class="n">timestamps_data_files</span><span class="p">):</span>
        <span class="n">subject_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">sio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">subject_filename</span><span class="p">)[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span>
        <span class="n">timestamp_data</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">timestamp_filename</span><span class="p">)[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">df_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">timestamp_data</span><span class="p">,</span> <span class="n">subject_data</span><span class="p">))</span>        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="s1">&#39;Values&#39;</span><span class="p">])</span>

        <span class="n">p_number</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;p\d+&#39;</span><span class="p">,</span> <span class="n">subject_filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_number</span>
        <span class="n">subjects_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">subjects_data</span><span class="p">,</span> <span class="n">feeltrace_data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">words_list</span><span class="p">,</span> <span class="n">feeltrace_list</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">words_list</span><span class="p">)</span>
<span class="n">feeltrace_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">feeltrace_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feeltrace_df</span><span class="o">.</span><span class="n">p_number</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;10&#39;, &#39;12&#39;, &#39;13&#39;, &#39;15&#39;, &#39;17&#39;, &#39;19&#39;, &#39;2&#39;, &#39;20&#39;, &#39;22&#39;, &#39;23&#39;, &#39;4&#39;,
       &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">words_list</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Timestamps</th>
      <th>Values</th>
      <th>p_number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>41100</td>
      <td>100.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>66900</td>
      <td>110.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>86833</td>
      <td>185.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>109466</td>
      <td>185.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>152233</td>
      <td>115.0</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">feeltrace_list</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Timestamps</th>
      <th>Feeltrace</th>
      <th>p_number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9437.0</td>
      <td>74.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9451.0</td>
      <td>74.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9471.0</td>
      <td>74.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9511.0</td>
      <td>75.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9548.0</td>
      <td>74.0</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="single-participant">
<h2>Single participant<a class="headerlink" href="#single-participant" title="Permalink to this headline">¶</a></h2>
<p>Testing code with a single subject</p>
<div class="section" id="downsampling-the-continuous-annotation">
<h3>Downsampling the continuous annotation<a class="headerlink" href="#downsampling-the-continuous-annotation" title="Permalink to this headline">¶</a></h3>
<p>Before time series analysis can be performed, we must downsample the feeltrace to match the sample size of the interview words (or upsample the interview words):</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{Fs}_{\text{feeltrace}} = 30\)</span>Hz</p></li>
<li><p><span class="math notranslate nohighlight">\(\text{Fs}_{\text{calibrated words}} \approx 0.05\)</span>Hz</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_words</span> <span class="o">=</span> <span class="n">words_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p10_feeltrace</span> <span class="o">=</span> <span class="n">feeltrace_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">p10_words</span><span class="o">.</span><span class="n">Values</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">p10_words</span><span class="o">.</span><span class="n">Values</span><span class="p">)</span>
<span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sampling_frequency</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sa">f</span><span class="s1">&#39;Fs Interview ~ %.2f Hz&#39;</span> <span class="o">%</span> <span class="n">sampling_frequency</span><span class="p">(</span><span class="n">p10_words</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Fs Interview ~ 0.04 Hz&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sa">f</span><span class="s1">&#39;Fs Feeltrace ~ %.2f Hz&#39;</span> <span class="o">%</span> <span class="n">sampling_frequency</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Fs Feeltrace ~ 29.64 Hz&#39;
</pre></div>
</div>
</div>
</div>
<p>Here, I attempt downsampling the feeltrace using aggregation strategies. I am using windows corresponding to midpoints in between sampled words. For instance, if the first interview word is recorded at <span class="math notranslate nohighlight">\(t=10\)</span>s and the next word is recorded at <span class="math notranslate nohighlight">\(t=15\)</span>s, the first window corresponds to <span class="math notranslate nohighlight">\(t=0\)</span>s to <span class="math notranslate nohighlight">\(t=12.5\)</span>s.</p>
<p>We can calculate windows using a rolling average on the interview timestamps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">p10_words</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">timestamps</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     54000.0
1     76866.5
2     98149.5
3    130849.5
4    158899.5
Name: Timestamps, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_words</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_21_0.png" src="_images/words-feeltrace_21_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_feeltrace</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_22_0.png" src="_images/words-feeltrace_22_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">p10_words</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p10_words</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_23_0.png" src="_images/words-feeltrace_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_24_0.png" src="_images/words-feeltrace_24_0.png" />
</div>
</div>
<p>Extract indexes in the feeltrace by looking at the nearest timestamp that matches our window start points:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">timestamp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">dist</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Indexes: %s&#39;</span> <span class="o">%</span> <span class="n">idxs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Indexes: [1331, 2024, 2641, 3629, 4477, 5016, 6008, 6779, 7638, 8859, 9432, 9794, 10266, 10732, 11658, 12617, 13246, 13851, 14264, 14702, 15357, 15873, 16053, 16588, 17221, 18343, 19784, 20457, 21141, 21975]
</pre></div>
</div>
</div>
</div>
<p>Timestamps for the new feeltrace are defined as the mean timestamp of the window ((window start + window end) / 2):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feeltrace_timestamps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">,</span> <span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># add first timestamp</span>
<span class="n">feeltrace_timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

<span class="c1"># add last timestamp</span>
<span class="n">feeltrace_timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Timestamps&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">feeltrace_timestamps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">feeltrace_timestamps</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Timestamps (ms): %s&#39;</span> <span class="o">%</span> <span class="n">feeltrace_timestamps</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamps (ms): 0     26996.0
1     65427.0
2     87506.5
3    114499.5
4    144872.5
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make sure both series are the same length</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feeltrace_timestamps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p10_words</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, I explore aggregating the feeltrace in two ways:</p>
<ul class="simple">
<li><p>By taking the mean value of all points in window</p></li>
<li><p>By calculating the overall direction of change in the feeltrace (slope)</p></li>
</ul>
<div class="section" id="aggregating-by-taking-the-mean">
<h4>Aggregating by taking the mean<a class="headerlink" href="#aggregating-by-taking-the-mean" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_feeltrace_agg_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="n">mean_feeltrace</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># first window</span>
<span class="n">mean_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="c1"># middle windows</span>
<span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idxs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">mean_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="c1"># last window</span>
<span class="n">mean_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="c1"># make sure both feeltrace and interview series are the same size</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_feeltrace</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p10_words</span><span class="o">.</span><span class="n">Values</span><span class="p">))</span>

<span class="n">p10_feeltrace_agg_mean</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feeltrace_timestamps</span>
<span class="n">p10_feeltrace_agg_mean</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_feeltrace</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_feeltrace_agg_mean</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Timestamps</th>
      <th>Feeltrace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>26996.0</td>
      <td>0.372654</td>
    </tr>
    <tr>
      <th>1</th>
      <td>65427.0</td>
      <td>0.413613</td>
    </tr>
    <tr>
      <th>2</th>
      <td>87506.5</td>
      <td>0.490906</td>
    </tr>
    <tr>
      <th>3</th>
      <td>114499.5</td>
      <td>0.552672</td>
    </tr>
    <tr>
      <th>4</th>
      <td>144872.5</td>
      <td>0.375592</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_feeltrace</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_feeltrace_agg_mean</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_words</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Values&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Original feeltrace&#39;</span><span class="p">,</span> <span class="s1">&#39;AggFeeltrace&#39;</span><span class="p">,</span> <span class="s1">&#39;Words&#39;</span><span class="p">]);</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_34_0.png" src="_images/words-feeltrace_34_0.png" />
</div>
</div>
<p>Checking autocorelation on aggregated data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">p10_feeltrace_agg_mean</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p10_feeltrace_agg_mean</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_36_0.png" src="_images/words-feeltrace_36_0.png" />
</div>
</div>
</div>
<div class="section" id="aggregating-by-taking-the-slope">
<h4>Aggregating by taking the slope<a class="headerlink" href="#aggregating-by-taking-the-slope" title="Permalink to this headline">¶</a></h4>
<p>Trying to bin state transitions in three values:</p>
<ul class="simple">
<li><p>Increase in stress level (+1)</p></li>
<li><p>Neutral (0)</p></li>
<li><p>Decrease in stress level (-1)</p></li>
</ul>
<p>Tried a few attemps, settling for taking first and last value of window:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">change_direction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">slope</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">slope</span>
       
    <span class="k">def</span> <span class="nf">slope_angle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">angle</span>
    
    <span class="k">def</span> <span class="nf">slope_sign</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">1e3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">slope</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">factor</span><span class="p">):</span> 
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">slope</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">factor</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">first_last</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
       
    <span class="k">return</span> <span class="n">first_last</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calculating for feeltrace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_feeltrace_agg_slope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="n">slope_feeltrace</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># first window</span>
<span class="n">slope_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="p">[:</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">[:</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

<span class="c1"># middle windows</span>
<span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idxs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">slope_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">],</span> <span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]))</span>

<span class="c1"># last window</span>
<span class="n">slope_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:],</span> <span class="n">p10_feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:]))</span>

<span class="c1"># make sure both feeltrace and interview series are the same size</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">slope_feeltrace</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p10_words</span><span class="o">.</span><span class="n">Values</span><span class="p">))</span>

<span class="n">p10_feeltrace_agg_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feeltrace_timestamps</span>
<span class="n">p10_feeltrace_agg_slope</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope_feeltrace</span>
<span class="n">p10_feeltrace_agg_slope</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Timestamps</th>
      <th>Feeltrace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>26996.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>65427.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>87506.5</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>114499.5</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>144872.5</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Also calculating the slope values based on the aggregated feeltrace data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_feeltrace_agg_mean_slope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="n">mean_feeltrace_words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p10_feeltrace_agg_mean</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># middle windows</span>
<span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">mean_feeltrace_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">p10_feeltrace_agg_mean</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">],</span> <span class="n">p10_feeltrace_agg_mean</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]))</span>

<span class="n">p10_feeltrace_agg_mean_slope</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_feeltrace_words</span>
<span class="n">p10_feeltrace_agg_mean_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamps</span>
<span class="n">p10_feeltrace_agg_mean_slope</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feeltrace</th>
      <th>Timestamps</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>54000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>76866.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>98149.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.0</td>
      <td>130849.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>158899.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Taking the slopes for interview words:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_words_agg_slope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="n">slope_words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p10_words</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># middle windows</span>
<span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">slope_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">p10_words</span><span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">],</span> <span class="n">p10_words</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]))</span>

<span class="n">p10_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope_words</span>
<span class="n">p10_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamps</span>
<span class="n">p10_words_agg_slope</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Values</th>
      <th>Timestamps</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>54000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>76866.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>98149.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.0</td>
      <td>130849.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.0</td>
      <td>158899.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_words</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Values&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_words_agg_slope</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Values&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Original words&#39;</span><span class="p">,</span> <span class="s1">&#39;AggWords&#39;</span><span class="p">]);</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_feeltrace</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_feeltrace_agg_slope</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]);</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Original feeltrace&#39;</span><span class="p">,</span> <span class="s1">&#39;AggSlopeFeeltrace&#39;</span><span class="p">]);</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_feeltrace_agg_mean</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">p10_feeltrace_agg_mean_slope</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;AggMeanFeeltrace&#39;</span><span class="p">,</span> <span class="s1">&#39;AggMeanSlopeFeeltrace&#39;</span><span class="p">]);</span>

<span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_46_0.png" src="_images/words-feeltrace_46_0.png" />
</div>
</div>
<p>To proceed with analysis, I will be comparing the transitions captured by word labels and by the aggregated feeltrace values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_agg_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">p10_agg_data</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p10_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p10_agg_data</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p10_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">p10_agg_data</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p10_feeltrace_agg_mean_slope</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">p10_agg_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Timestamps</th>
      <th>Words</th>
      <th>Feeltrace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>54000.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>76866.5</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>98149.5</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>130849.5</td>
      <td>-1.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>158899.5</td>
      <td>-1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Checking autocorelation on aggregated data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">p10_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p10_words_agg_slope</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_50_0.png" src="_images/words-feeltrace_50_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">p10_feeltrace_agg_mean_slope</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p10_feeltrace_agg_mean_slope</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_51_0.png" src="_images/words-feeltrace_51_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="joint-time-series-analysis">
<h3>Joint time series analysis<a class="headerlink" href="#joint-time-series-analysis" title="Permalink to this headline">¶</a></h3>
<p>Refer to <em>Ernst AF, Timmerman ME, Jeronimus BF, Albers CJ. Insight into individual differences in emotion dynamics with clustering. Assessment. 2021 Jun;28(4):1186-206.</em></p>
<p>*Adapted from <a class="reference external" href="https://gist.github.com/BioSciEconomist/197bd86ea61e0b4a49707af74a0b9f9c">BioSciEconomist/ex VAR.py</a>.</p>
<div class="section" id="granger-causality">
<h4>Granger Causality<a class="headerlink" href="#granger-causality" title="Permalink to this headline">¶</a></h4>
<p>The results of Granger Causality for P10 are promising, suggeting a significant relationship* between interview words and feeltrace.</p>
<p>*(potentially a causality relationship, although this might be too strong of a claim, see <code class="docutils literal notranslate"><span class="pre">Limitations</span></code> section below)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">grangercausalitytests</span>
<span class="n">maxlag</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;ssr_chi2test&#39;</span>

<span class="k">def</span> <span class="nf">grangers_causation_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s1">&#39;ssr_chi2test&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>    
    <span class="sd">&quot;&quot;&quot;Check Granger Causality of all possible combinations of the Time series.</span>
<span class="sd">    The rows are the response variable, columns are predictors. The values in the table </span>
<span class="sd">    are the P-Values. P-Values lesser than the significance level (0.05), implies </span>
<span class="sd">    the Null Hypothesis that the coefficients of the corresponding past values is </span>
<span class="sd">    zero, that is, the X does not cause Y can be rejected.</span>

<span class="sd">    data      : pandas dataframe containing the time series variables</span>
<span class="sd">    variables : list containing names of the time series variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">test_result</span> <span class="o">=</span> <span class="n">grangercausalitytests</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]],</span> <span class="n">maxlag</span><span class="o">=</span><span class="n">maxlag</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">p_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxlag</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Y = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1">, X = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">, P Values = </span><span class="si">{</span><span class="n">p_values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">min_p_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">p_values</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">min_p_value</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_p_value</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_x&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_y&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">grangers_causation_matrix</span><span class="p">(</span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]],</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
        <span class="n">maxlag</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">maxlag</span><span class="o">-=</span><span class="mi">1</span>
        <span class="n">grangers_causation_matrix</span><span class="p">(</span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]],</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
        <span class="nb">print</span><span class="p">(</span><span class="n">maxlag</span><span class="p">)</span>
        <span class="k">break</span>

<span class="c1"># notes: </span>
<span class="c1"># The row are the Response (Y) and the columns are the predictor series (X).</span>

<span class="c1"># For example, if you take the value 0.0021 in (row 1, column 2), it refers to </span>
<span class="c1"># the p-value of Feeltrace_x causing Words_y.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Y = Words, X = Words, P Values = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
Y = Feeltrace, X = Words, P Values = [0.03955, 0.11261, 0.08867, 0.14009, 0.18742, 0.33951, 6e-05]
Y = Words, X = Feeltrace, P Values = [0.91608, 0.83781, 0.93154, 0.44377, 0.08686, 0.05786, 0.01882]
Y = Feeltrace, X = Feeltrace, P Values = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
7
</pre></div>
</div>
</div>
</div>
<div class="section" id="limitations">
<h5>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h5>
<p>(see <a class="reference external" href="https://en.wikipedia.org/wiki/Granger_causality#Limitations">https://en.wikipedia.org/wiki/Granger_causality#Limitations</a>)</p>
<p>As its name implies, Granger causality is not necessarily true causality. In fact, the Granger-causality tests fulfill only the Humean definition of causality that identifies the cause-effect relations with constant conjunctions.[14] If both X and Y are driven by a common third process with different lags, one might still fail to reject the alternative hypothesis of Granger causality. Yet, manipulation of one of the variables would not change the other. Indeed, the Granger-causality tests are designed to handle pairs of variables, and may produce misleading results when the true relationship involves three or more variables. Having said this, it has been argued that given a probabilistic view of causation, Granger causality can be considered true causality in that sense, especially when Reichenbach’s “screening off” notion of probabilistic causation is taken into account.[15] Other possible sources of misguiding test results are: (1) not frequent enough or too frequent sampling, (2) nonlinear causal relationship, (3) time series nonstationarity and nonlinearity and (4) existence of rational expectations.[14] A similar test involving more variables can be applied with vector autoregression. Recently [16] a fundamental mathematical study of the mechanism underlying the Granger method has been provided. By making use exclusively of mathematical tools (Fourier transformation and differential calculus), it has been found that not even the most basic requirement underlying any possible definition of causality is met by the Granger causality test: any definition of causality should refer to the prediction of the future from the past; instead by inverting the time series it can be shown that Granger allows one to ”predict” the past from the future as well.</p>
</div>
</div>
<div class="section" id="cointegration">
<h4>Cointegration<a class="headerlink" href="#cointegration" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------------</span>
<span class="c1"># cointegration</span>
<span class="c1">#-----------------------------------------</span>

<span class="c1"># When two or more time series are cointegrated, it means they have a long run, </span>
<span class="c1"># statistically significant relationship.</span>

<span class="c1"># This is the basic premise on which Vector Autoregression(VAR) models is based on. </span>
<span class="c1"># So, it’s fairly common to implement the cointegration test before starting to </span>
<span class="c1"># build VAR models.</span>

<span class="c1"># more technically:</span>
<span class="c1"># Order of integration(d) is nothing but the number of differencing required to </span>
<span class="c1"># make a non-stationary time series stationary.</span>

<span class="c1"># Now, when you have two or more time series, and there exists a linear combination</span>
<span class="c1">#  of them that has an order of integration (d) less than that of the individual </span>
<span class="c1"># series, then the collection of series is said to be cointegrated.</span>

<span class="kn">from</span> <span class="nn">statsmodels.tsa.vector_ar.vecm</span> <span class="kn">import</span> <span class="n">coint_johansen</span>

<span class="k">def</span> <span class="nf">cointegration_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Perform Johanson&#39;s Cointegration Test and Report Summary&quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">coint_johansen</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0.90&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;0.95&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;0.99&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
    <span class="n">traces</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">lr1</span>
    <span class="n">cvts</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">cvt</span><span class="p">[:,</span> <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)]]</span>
    <span class="k">def</span> <span class="nf">adjust</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span> <span class="mi">6</span><span class="p">):</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Summary</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name   ::  Test Stat &gt; C(95%)    =&gt;   Signif  </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">cvt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">traces</span><span class="p">,</span> <span class="n">cvts</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">adjust</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="s1">&#39;:: &#39;</span><span class="p">,</span> <span class="n">adjust</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">9</span><span class="p">),</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">adjust</span><span class="p">(</span><span class="n">cvt</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="s1">&#39; =&gt;  &#39;</span> <span class="p">,</span> <span class="n">trace</span> <span class="o">&gt;</span> <span class="n">cvt</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="p">[</span><span class="n">trace</span><span class="p">,</span> <span class="n">cvt</span><span class="p">,</span> <span class="n">trace</span> <span class="o">&gt;</span> <span class="n">cvt</span><span class="p">]})</span>
        
    <span class="k">return</span> <span class="n">results</span>

<span class="n">cointegration_test</span><span class="p">(</span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;Words&#39;: [25.090662611093716, 12.3212, True]},
 {&#39;Feeltrace&#39;: [5.576373930313893, 4.1296, True]}]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="stationarity">
<h4>Stationarity<a class="headerlink" href="#stationarity" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>

<span class="c1">#------------------------------</span>
<span class="c1"># check for stationarity</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># VAR model requires the time series you want to forecast to be stationary, </span>
<span class="c1"># it is customary to check all the time series in the system for stationarity.</span>

<span class="c1"># Since, differencing reduces the length of the series by 1 and since all the </span>
<span class="c1"># time series has to be of the same length, you need to difference all the series</span>
<span class="c1">#  in the system if you choose to difference at all.</span>

<span class="k">def</span> <span class="nf">adfuller_test</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">signif</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Perform ADFuller to test for Stationarity of given series and print report&quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test_statistic&#39;</span><span class="p">:</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;pvalue&#39;</span><span class="p">:</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;n_lags&#39;</span><span class="p">:</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="s1">&#39;n_obs&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
    <span class="n">p_value</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;pvalue&#39;</span><span class="p">]</span> 
    <span class="k">def</span> <span class="nf">adjust</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span> <span class="mi">6</span><span class="p">):</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="c1"># Print Summary</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    Augmented Dickey-Fuller Test on &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   &quot;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">47</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Null Hypothesis: Data has unit root. Non-Stationary.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Significance Level    = </span><span class="si">{</span><span class="n">signif</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Test Statistic        = </span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;test_statistic&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; No. Lags Chosen       = </span><span class="si">{</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;n_lags&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Critical value </span><span class="si">{</span><span class="n">adjust</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;=</span> <span class="n">signif</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; =&gt; P-Value = </span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s2">. Rejecting Null Hypothesis.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; =&gt; Series is Stationary.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; =&gt; P-Value = </span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s2">. Weak evidence to reject the Null Hypothesis.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; =&gt; Series is Non-Stationary.&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">output</span>
        
 <span class="c1"># ADF Test on each column</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">p10_agg_data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;Timestamps&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">adfuller_test</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>    
    
<span class="n">diff</span> <span class="o">=</span> <span class="n">p10_agg_data</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># ADF Test on each column</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">diff</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;Timestamps&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">adfuller_test</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pearson-s-correlation">
<h4>Pearson’s correlation<a class="headerlink" href="#pearson-s-correlation" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Words</th>
      <th>Feeltrace</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Words</th>
      <td>1.000000</td>
      <td>0.365165</td>
    </tr>
    <tr>
      <th>Feeltrace</th>
      <td>0.365165</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="var-model">
<h4>VAR Model<a class="headerlink" href="#var-model" title="Permalink to this headline">¶</a></h4>
<div class="section" id="training-and-validation-data">
<h5>Training and validation data<a class="headerlink" href="#training-and-validation-data" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The VAR model will be fitted on df_train and then used to forecast the next 4 </span>
<span class="c1"># observations. These forecasts will be compared against the actuals present in </span>
<span class="c1"># test data.</span>


<span class="n">nobs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">p10_agg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">nobs</span><span class="p">],</span> <span class="n">p10_agg_data</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span><span class="p">:]</span>

<span class="c1"># Check size</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (119, 8)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (4, 8)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(26, 3)
(4, 3)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fitting">
<h5>Fitting<a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#---------------------------------------</span>
<span class="c1"># fitting the order of the VAR</span>
<span class="c1">#--------------------------------------</span>

<span class="c1"># To select the right order of the VAR model, we iteratively fit increasing orders </span>
<span class="c1"># of VAR model and pick the order that gives a model with least AIC.</span>

<span class="n">df_train_diff</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">df_train_diff</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lag Order =&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AIC : &#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BIC : &#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FPE : &#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">fpe</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HQIC: &#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">hqic</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Lag Order = 1
AIC :  0.05775404864776357
BIC :  0.3522675062347499
FPE :  1.0622432071420118
HQIC:  0.13588855185103732 

Lag Order = 2
AIC :  0.0931959320852247
BIC :  0.5868890694457246
FPE :  1.1132639758642113
HQIC:  0.2173583723415481 

Lag Order = 3
AIC :  -0.27946635048747726
BIC :  0.41483339255872376
FPE :  0.7915973875719311
HQIC:  -0.11591020813616004 

Lag Order = 4
AIC :  -0.13823926468913883
BIC :  0.7570656819309383
FPE :  0.9802540411704659
HQIC:  0.05606482781369326 

Lag Order = 5
AIC :  -0.23709251936825293
BIC :  0.8582129815411368
FPE :  1.0371045407615151
HQIC:  -0.023277378565365936 

Lag Order = 6
AIC :  -2.3461160602640394
BIC :  -1.053725878246805
FPE :  0.176399265652843
HQIC:  -2.1273922931509723 

Lag Order = 7
AIC :  -4.035830765283158
BIC :  -2.5518778354562173
FPE :  0.07627778373435394
HQIC:  -3.831213665944237 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/rubiarg/.virtualenvs/cpsc554x/lib/python3.9/site-packages/statsmodels/tsa/base/tsa_model.py:471: ValueWarning: An unsupported index was provided and will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In the above output, the AIC drops to lowest at lag 4, then increases at </span>
<span class="c1"># lag 5 and then continuously drops further. (more negative = &#39;smaller&#39; AIC)</span>

<span class="c1">#---------------------------------</span>
<span class="c1"># alterntative: auto fit</span>
<span class="c1">#---------------------------------</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">select_order</span><span class="p">(</span><span class="n">maxlags</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>VAR Order Selection (* highlights the minimums)</caption>
<tr>
  <td></td>      <th>AIC</th>         <th>BIC</th>         <th>FPE</th>        <th>HQIC</th>    
</tr>
<tr>
  <th>0</th> <td>    0.6794</td>  <td>    0.7783</td>  <td>     1.973</td>  <td>    0.6930</td> 
</tr>
<tr>
  <th>1</th> <td>    0.1607</td>  <td>    0.4575</td>  <td>     1.182</td>  <td>    0.2016</td> 
</tr>
<tr>
  <th>2</th> <td>    0.1338</td>  <td>    0.6285</td>  <td>     1.178</td>  <td>    0.2020</td> 
</tr>
<tr>
  <th>3</th> <td>   -0.7488</td>  <td>  -0.05632</td>  <td>    0.5156</td>  <td>   -0.6533</td> 
</tr>
<tr>
  <th>4</th> <td>   -0.4248</td>  <td>    0.4656</td>  <td>    0.7965</td>  <td>   -0.3020</td> 
</tr>
<tr>
  <th>5</th> <td>    -1.364</td>  <td>   -0.2761</td>  <td>    0.3806</td>  <td>    -1.214</td> 
</tr>
<tr>
  <th>6</th> <td>    -2.820</td>  <td>    -1.534</td>  <td>    0.1275</td>  <td>    -2.642</td> 
</tr>
<tr>
  <th>7</th> <td>    -4.036*</td> <td>    -2.552*</td> <td>   0.07628*</td> <td>    -3.831*</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#----------------------------------</span>
<span class="c1"># fit VAR(5)</span>
<span class="c1">#---------------------------------</span>

<span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">model_fitted</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Summary of Regression Results   
==================================
Model:                         VAR
Method:                        OLS
Date:           Sun, 17, Apr, 2022
Time:                     10:09:48
--------------------------------------------------------------------
No. of Equations:         2.00000    BIC:                   -2.55188
Nobs:                     18.0000    HQIC:                  -3.83121
Log likelihood:           15.2407    FPE:                  0.0762778
AIC:                     -4.03583    Det(Omega_mle):       0.0226942
--------------------------------------------------------------------
Results for equation Words
===============================================================================
                  coefficient       std. error           t-stat            prob
-------------------------------------------------------------------------------
const               -0.035169         0.153833           -0.229           0.819
L1.Words            -0.011307         0.532488           -0.021           0.983
L1.Feeltrace        -0.732441         0.520667           -1.407           0.160
L2.Words            -0.197281         0.508668           -0.388           0.698
L2.Feeltrace         0.060661         0.670046            0.091           0.928
L3.Words            -0.680142         0.404042           -1.683           0.092
L3.Feeltrace        -0.864088         0.877978           -0.984           0.325
L4.Words            -0.289154         0.511805           -0.565           0.572
L4.Feeltrace         0.111096         0.870605            0.128           0.898
L5.Words            -0.660060         0.436983           -1.510           0.131
L5.Feeltrace         0.151081         0.821988            0.184           0.854
L6.Words            -0.290736         0.474940           -0.612           0.540
L6.Feeltrace        -0.741181         0.827518           -0.896           0.370
L7.Words             0.407364         0.463551            0.879           0.380
L7.Feeltrace        -0.702482         0.542307           -1.295           0.195
===============================================================================

Results for equation Feeltrace
===============================================================================
                  coefficient       std. error           t-stat            prob
-------------------------------------------------------------------------------
const               -0.086138         0.148971           -0.578           0.563
L1.Words             0.572365         0.515657            1.110           0.267
L1.Feeltrace        -1.048993         0.504210           -2.080           0.037
L2.Words            -0.303632         0.492590           -0.616           0.538
L2.Feeltrace        -0.592023         0.648867           -0.912           0.362
L3.Words            -0.444206         0.391271           -1.135           0.256
L3.Feeltrace        -0.985148         0.850227           -1.159           0.247
L4.Words            -0.070229         0.495628           -0.142           0.887
L4.Feeltrace        -0.014493         0.843087           -0.017           0.986
L5.Words             0.111453         0.423171            0.263           0.792
L5.Feeltrace        -0.257587         0.796007           -0.324           0.746
L6.Words             0.558299         0.459929            1.214           0.225
L6.Feeltrace        -0.692143         0.801362           -0.864           0.388
L7.Words             0.163817         0.448899            0.365           0.715
L7.Feeltrace         0.143590         0.525165            0.273           0.785
===============================================================================

Correlation matrix of residuals
                Words  Feeltrace
Words        1.000000   0.832281
Feeltrace    0.832281   1.000000
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="check-for-remaining-serial-correlation">
<h5>Check for remaining serial correlation<a class="headerlink" href="#check-for-remaining-serial-correlation" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Serial correlation of residuals is used to check if there is any leftover pattern </span>
<span class="c1"># in the residuals (errors). If there is any correlation left in the residuals, then,</span>
<span class="c1"># there is some pattern in the time series that is still left to be explained by the</span>
<span class="c1"># model. In that case, the typical course of action is to either increase the order</span>
<span class="c1"># of the model or induce more predictors into the system or look for a different </span>
<span class="c1"># algorithm to model the time series.</span>

<span class="c1"># A common way of checking for serial correlation of errors can be measured using </span>
<span class="c1"># the Durbin Watson’s Statistic.</span>

<span class="c1"># The value of this statistic can vary between 0 and 4. The closer it is to the value </span>
<span class="c1"># 2, then there is no significant serial correlation. The closer to 0, there is a </span>
<span class="c1"># positive serial correlation, and the closer it is to 4 implies negative serial </span>
<span class="c1"># correlation.</span>

<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">durbin_watson</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">durbin_watson</span><span class="p">(</span><span class="n">model_fitted</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>

<span class="c1"># for col, val in zip(df.columns, out):</span>
<span class="c1">#    print(adjust(col), &#39;:&#39;, round(val, 2))</span>
    
<span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Words : 1.93
Feeltrace : 1.04
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="forecasting">
<h5>Forecasting<a class="headerlink" href="#forecasting" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#--------------------------------------</span>
<span class="c1"># forecasting</span>
<span class="c1">#--------------------------------------</span>

<span class="c1"># In order to forecast, the VAR model expects up to the lag order number of </span>
<span class="c1"># observations from the past data. This is because, the terms in the VAR model </span>
<span class="c1"># are essentially the lags of the various time series in the dataset, so you </span>
<span class="c1"># need to provide it as many of the previous values as indicated by the lag order</span>
<span class="c1"># used by the model.</span>

<span class="c1"># Get the lag order (we already know this)</span>
<span class="n">lag_order</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">k_ar</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lag_order</span><span class="p">)</span>  <span class="c1">#&gt; 4</span>

<span class="c1"># Input data for forecasting</span>
<span class="n">forecast_input</span> <span class="o">=</span> <span class="n">df_train_diff</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="n">lag_order</span><span class="p">:]</span>
<span class="n">forecast_input</span>

<span class="c1"># Forecast</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">forecast_input</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">nobs</span><span class="p">)</span> <span class="c1"># nobs defined at top of program</span>
<span class="n">df_forecast</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span><span class="p">:],</span> <span class="n">columns</span><span class="o">=</span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span> <span class="o">+</span> <span class="s1">&#39;_1d&#39;</span><span class="p">)</span>
<span class="n">df_forecast</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Words_1d</th>
      <th>Feeltrace_1d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26</th>
      <td>3.433782</td>
      <td>-0.078952</td>
    </tr>
    <tr>
      <th>27</th>
      <td>-0.456890</td>
      <td>1.890234</td>
    </tr>
    <tr>
      <th>28</th>
      <td>-3.966676</td>
      <td>-4.530015</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1.957641</td>
      <td>0.401022</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The forecasts are generated but it is on the scale of the training data used by </span>
<span class="c1"># the model. So, to bring it back up to its original scale, you need to de-difference </span>
<span class="c1"># it as many times you had differenced the original input data.</span>

<span class="k">def</span> <span class="nf">invert_transformation</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_forecast</span><span class="p">,</span> <span class="n">second_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Revert back the differencing to get the forecast to original scale.&quot;&quot;&quot;</span>
    <span class="n">df_fc</span> <span class="o">=</span> <span class="n">df_forecast</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">columns</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>     
        <span class="k">if</span> <span class="s1">&#39;Timestamp&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Roll back 2nd Diff</span>
        <span class="k">if</span> <span class="n">second_diff</span><span class="p">:</span>
            <span class="n">df_fc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_1d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">df_fc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_2d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="c1"># Roll back 1st Diff</span>
        <span class="n">df_fc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_forecast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_fc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_1d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df_fc</span>


<span class="n">df_results</span> <span class="o">=</span> <span class="n">invert_transformation</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_forecast</span><span class="p">,</span> <span class="n">second_diff</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>        
<span class="n">df_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;Words_1d&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace_1d&#39;</span><span class="p">]]</span>

<span class="c1">#---------------------------</span>
<span class="c1"># plot forecasts</span>
<span class="c1">#---------------------------</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p10_agg_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">p10_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">())):</span>
    <span class="n">df_results</span><span class="p">[</span><span class="n">col</span><span class="o">+</span><span class="s1">&#39;_forecast&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_test</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="o">-</span><span class="n">nobs</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;: Forecast vs Actuals&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_75_0.png" src="_images/words-feeltrace_75_0.png" />
</div>
</div>
</div>
<div class="section" id="accuracy">
<h5>Accuracy<a class="headerlink" href="#accuracy" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span>

<span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">):</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>  <span class="c1"># MAPE</span>
    <span class="n">me</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span>             <span class="c1"># ME</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>    <span class="c1"># MAE</span>
    <span class="n">mpe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">/</span><span class="n">actual</span><span class="p">)</span>   <span class="c1"># MPE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span>  <span class="c1"># RMSE</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># corr</span>
    <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">forecast</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span> 
                              <span class="n">actual</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">maxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">forecast</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span> 
                              <span class="n">actual</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">minmax</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mins</span><span class="o">/</span><span class="n">maxs</span><span class="p">)</span>             <span class="c1"># minmax</span>
    <span class="k">return</span><span class="p">({</span><span class="s1">&#39;mape&#39;</span><span class="p">:</span><span class="n">mape</span><span class="p">,</span> <span class="s1">&#39;me&#39;</span><span class="p">:</span><span class="n">me</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">:</span> <span class="n">mae</span><span class="p">,</span> 
            <span class="s1">&#39;mpe&#39;</span><span class="p">:</span> <span class="n">mpe</span><span class="p">,</span> <span class="s1">&#39;rmse&#39;</span><span class="p">:</span><span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;corr&#39;</span><span class="p">:</span><span class="n">corr</span><span class="p">,</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span><span class="n">minmax</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Forecast Accuracy of: Words&#39;</span><span class="p">)</span>
<span class="n">accuracy_prod</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Words_forecast&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">accuracy_prod</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Forecast Accuracy of: Feeltrace&#39;</span><span class="p">)</span>
<span class="n">accuracy_prod</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Feeltrace_forecast&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">accuracy_prod</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Forecast Accuracy of: Words
mape :  2.1082
me :  0.0972
mae :  2.1082
mpe :  -1.3913
rmse :  2.287
corr :  -0.4531
minmax :  1.5292

Forecast Accuracy of: Feeltrace
mape :  inf
me :  -1.076
mae :  1.4817
mpe :  -inf
rmse :  1.9122
corr :  0.502
minmax :  inf
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/bl/2tw1vrc12mv_hqpbdf1j3wkw0000gn/T/ipykernel_89397/1231121430.py:11: FutureWarning: Support for multi-dimensional indexing (e.g. `obj[:, None]`) is deprecated and will be removed in a future version.  Convert to a numpy array before indexing instead.
  actual[:,None]]), axis=1)
/var/folders/bl/2tw1vrc12mv_hqpbdf1j3wkw0000gn/T/ipykernel_89397/1231121430.py:13: FutureWarning: Support for multi-dimensional indexing (e.g. `obj[:, None]`) is deprecated and will be removed in a future version.  Convert to a numpy array before indexing instead.
  actual[:,None]]), axis=1)
/var/folders/bl/2tw1vrc12mv_hqpbdf1j3wkw0000gn/T/ipykernel_89397/1231121430.py:14: RuntimeWarning: divide by zero encountered in true_divide
  minmax = 1 - np.mean(mins/maxs)             # minmax
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_fitted</span><span class="o">.</span><span class="n">coefs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[-0.01130686, -0.73244081],
        [ 0.57236544, -1.04899342]],

       [[-0.19728086,  0.06066069],
        [-0.30363155, -0.59202253]],

       [[-0.68014208, -0.86408763],
        [-0.44420634, -0.98514756]],

       [[-0.28915429,  0.11109575],
        [-0.07022896, -0.01449273]],

       [[-0.66005976,  0.15108138],
        [ 0.11145259, -0.25758653]],

       [[-0.29073581, -0.74118144],
        [ 0.55829852, -0.69214343]],

       [[ 0.40736375, -0.70248155],
        [ 0.16381727,  0.14359025]]])
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="all-participants">
<h2>All participants<a class="headerlink" href="#all-participants" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prepare_data</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">feeltrace</span><span class="p">):</span>
    <span class="n">p_words</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p_feeltrace</span> <span class="o">=</span> <span class="n">feeltrace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">p_words</span><span class="o">.</span><span class="n">Values</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Values</span><span class="p">)</span>
    <span class="n">p_words</span><span class="o">.</span><span class="n">p_number</span> <span class="o">=</span> <span class="n">p_num_map</span><span class="p">[</span><span class="n">p_words</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">p_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span> <span class="o">=</span> <span class="n">scale</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="p">)</span>
    <span class="n">p_feeltrace</span><span class="o">.</span><span class="n">p_number</span> <span class="o">=</span> <span class="n">p_num_map</span><span class="p">[</span><span class="n">p_feeltrace</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        
    <span class="k">return</span> <span class="n">p_words</span><span class="p">,</span> <span class="n">p_feeltrace</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_indexes</span><span class="p">(</span><span class="n">feeltrace</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    

    <span class="k">for</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">timestamp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">dist</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dist</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">timestamps</span>


<span class="k">def</span> <span class="nf">get_feeltrace_timestamps</span><span class="p">(</span><span class="n">feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">):</span>
    <span class="n">feeltrace_timestamps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">,</span> <span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="c1"># add first timestamp</span>
    <span class="n">feeltrace_timestamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># add last timestamp</span>
    <span class="n">feeltrace_timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;Timestamps&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">feeltrace_timestamps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">feeltrace_timestamps</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">feeltrace_timestamps</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">aggregate_mean</span><span class="p">(</span><span class="n">feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">):</span>
    <span class="n">feeltrace_agg_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">mean_feeltrace</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># first window</span>
    <span class="n">mean_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># middle windows</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idxs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">mean_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># last window</span>
    <span class="n">mean_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="c1"># make sure both feeltrace and interview series are the same size</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_feeltrace</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Values</span><span class="p">))</span>

    <span class="n">feeltrace_agg_mean</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feeltrace_timestamps</span>
    <span class="n">feeltrace_agg_mean</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_feeltrace</span>
    
    <span class="k">return</span> <span class="n">feeltrace_agg_mean</span>

<span class="k">def</span> <span class="nf">aggregate_slope</span><span class="p">(</span><span class="n">feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">):</span>
    <span class="n">feeltrace_agg_slope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">slope_feeltrace</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># first window</span>
    <span class="n">slope_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="p">[:</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">[:</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

    <span class="c1"># middle windows</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idxs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">slope_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">],</span> <span class="n">feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]))</span>

    <span class="c1"># last window</span>
    <span class="n">slope_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">feeltrace</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:],</span> <span class="n">feeltrace</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:]))</span>

    <span class="n">feeltrace_agg_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feeltrace_timestamps</span>
    <span class="n">feeltrace_agg_slope</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope_feeltrace</span>
    <span class="n">feeltrace_agg_slope</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">feeltrace_agg_slope</span>
</pre></div>
</div>
</div>
</div>
<p>Renaming participants:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_num_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> 
             <span class="s1">&#39;7&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> 
             <span class="s1">&#39;12&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> 
             <span class="s1">&#39;19&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="states">
<h3>States<a class="headerlink" href="#states" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>

<span class="n">n_windows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">granger_p_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stationarity</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cointegration_p_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pearsons_corr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">var_models</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="p">(</span><span class="n">p_words</span><span class="p">,</span> <span class="n">p_feeltrace</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words_list</span><span class="p">,</span> <span class="n">feeltrace_list</span><span class="p">):</span>
    <span class="p">[</span><span class="n">p_words</span><span class="p">,</span> <span class="n">p_feeltrace</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepare_data</span><span class="p">(</span><span class="n">p_words</span><span class="p">,</span> <span class="n">p_feeltrace</span><span class="p">)</span>
    
    <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Words&#39;</span><span class="p">:</span> <span class="n">sampling_frequency</span><span class="p">(</span><span class="n">p_words</span><span class="p">),</span> 
               <span class="s1">&#39;Feeltrace&#39;</span><span class="p">:</span> <span class="n">sampling_frequency</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">),</span>
               <span class="s1">&#39;p_number&#39;</span><span class="p">:</span> <span class="n">p_feeltrace</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
              <span class="p">})</span>
    
    <span class="p">[</span><span class="n">idxs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_indexes</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">,</span> <span class="n">p_words</span><span class="p">)</span>
    <span class="n">feeltrace_timestamps</span> <span class="o">=</span> <span class="n">get_feeltrace_timestamps</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">)</span>
    
    <span class="c1"># make sure both timestamps are the same length</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feeltrace_timestamps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">))</span>
    
    <span class="n">n_windows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;p_number&#39;</span><span class="p">:</span> <span class="n">p_words</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;n_windows&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">feeltrace_timestamps</span><span class="p">)})</span>
    
    <span class="n">p_feeltrace_agg_mean</span> <span class="o">=</span> <span class="n">aggregate_mean</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">)</span>
    
    <span class="c1"># make sure both feeltrace and interview series are the same size</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_feeltrace_agg_mean</span><span class="o">.</span><span class="n">Feeltrace</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Values</span><span class="p">))</span>
    
    <span class="n">p_agg_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_words</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_words</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_feeltrace_agg_mean</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="n">maxlag</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># transitions</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">grangers_causation_matrix</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]],</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
            <span class="n">maxlag</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">maxlag</span><span class="o">-=</span><span class="mi">1</span>
            <span class="n">granger_p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grangers_causation_matrix</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]],</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
            <span class="k">break</span>
            
    <span class="n">stationarity</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;p_number&#39;</span><span class="p">:</span> <span class="n">p_feeltrace</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="s1">&#39;Words&#39;</span><span class="p">:</span> <span class="n">adfuller_test</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">]),</span> 
                         <span class="s1">&#39;Feeltrace&#39;</span><span class="p">:</span> <span class="n">adfuller_test</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">])</span>
                        <span class="p">})</span>
    <span class="n">cointegration_p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cointegration_test</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]))</span>
    <span class="n">pearsons_corr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">],</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]))</span>
    
    <span class="c1"># The VAR model will be fitted on df_train and then used to forecast the next 4 </span>
    <span class="c1"># observations. These forecasts will be compared against the actuals present in </span>
    <span class="c1"># test data.</span>


    <span class="n">nobs</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">p_agg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">nobs</span><span class="p">],</span> <span class="n">p_agg_data</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span><span class="p">:]</span>

    <span class="c1"># Check size</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]])</span>

    <span class="n">maxlag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">select_order</span><span class="p">(</span><span class="n">maxlags</span><span class="o">=</span><span class="n">maxlag</span><span class="p">)</span>
            <span class="n">maxlag</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">maxlag</span><span class="o">-=</span><span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">select_order</span><span class="p">(</span><span class="n">maxlags</span><span class="o">=</span><span class="n">maxlag</span><span class="p">)</span>
            <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maxlag</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="n">var_models</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">model_fitted</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/rubiarg/.virtualenvs/cpsc554x/lib/python3.9/site-packages/statsmodels/tsa/vector_ar/vecm.py:726: RuntimeWarning: invalid value encountered in log
  tmp = np.log(iota - a)[i:]
/Users/rubiarg/.virtualenvs/cpsc554x/lib/python3.9/site-packages/statsmodels/tsa/vector_ar/vecm.py:728: RuntimeWarning: invalid value encountered in log
  lr2[i] = -t * np.log(1 - a[i])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">n_windows</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For the following secionts, I perform multiple comparisons using Bonferroni-Holm correction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.multitest</span> <span class="kn">import</span> <span class="n">multipletests</span>
<span class="n">rejected</span><span class="p">,</span> <span class="n">p_adjusted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_corrected</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">raw_pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> 
                               <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">,</span> <span class="n">is_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">returnsorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rejected</span><span class="p">)</span>
<span class="c1"># 2</span>
<span class="n">alpha_corrected</span> 
<span class="c1"># 0.0005</span>

</pre></div>
</div>
<div class="section" id="id1">
<h4>Granger Causality<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>TODO: calculate power / effect size</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_to_feeltrace</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">feeltrace_to_words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">granger_p_values</span><span class="p">:</span>
    <span class="n">words_to_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">Words_x</span><span class="o">.</span><span class="n">Feeltrace_y</span><span class="p">)</span>
    <span class="n">feeltrace_to_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">Feeltrace_x</span><span class="o">.</span><span class="n">Words_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.multitest</span> <span class="kn">import</span> <span class="n">multipletests</span>
<span class="n">rejected</span><span class="p">,</span> <span class="n">p_adjusted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_corrected</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">words_to_feeltrace</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                                         <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">,</span> 
                                                         <span class="n">is_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">returnsorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rejected H0: %d&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rejected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corrected alpha: %f&#39;</span> <span class="o">%</span> <span class="n">alpha_corrected</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">words_to_feeltrace</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p_adjusted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adujusted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of p-values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rejected H0: 10
Corrected alpha: 0.003125
</pre></div>
</div>
<img alt="_images/words-feeltrace_92_1.png" src="_images/words-feeltrace_92_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      8
2     10
4     12
5     13
6      1
7     14
8     15
9     16
12     4
13     5
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1      9
3     11
10     2
11     3
14     6
15     7
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.multitest</span> <span class="kn">import</span> <span class="n">multipletests</span>
<span class="n">rejected</span><span class="p">,</span> <span class="n">p_adjusted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_corrected</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">feeltrace_to_words</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                                         <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">,</span> 
                                                         <span class="n">is_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">returnsorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rejected H0: %d&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rejected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corrected alpha: %f&#39;</span> <span class="o">%</span> <span class="n">alpha_corrected</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">feeltrace_to_words</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p_adjusted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adujusted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of p-values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rejected H0: 12
Corrected alpha: 0.003125
</pre></div>
</div>
<img alt="_images/words-feeltrace_95_1.png" src="_images/words-feeltrace_95_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      8
1      9
2     10
3     11
6      1
7     14
8     15
9     16
11     3
13     5
14     6
15     7
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4     12
5     13
10     2
12     4
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h4>Cointegration<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>TODO: summarize</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cointegration_p_values</span> <span class="c1"># not p-values, different test statistic</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[{&#39;Words&#39;: [3.4212347600699022, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.2385070084338315, 4.1296, False]}],
 [{&#39;Words&#39;: [7.75522318438243, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.4052903886683129, 4.1296, False]}],
 [{&#39;Words&#39;: [6.992609081946456, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.5163451921786284, 4.1296, False]}],
 [{&#39;Words&#39;: [5.344539328990742, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.15470771521714644, 4.1296, False]}],
 [{&#39;Words&#39;: [6.006007817148245, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.6873254132523675, 4.1296, False]}],
 [{&#39;Words&#39;: [5.738308052628689, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.0025107181676411504, 4.1296, False]}],
 [{&#39;Words&#39;: [7.157326702356029, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.15934413516699125, 4.1296, False]}],
 [{&#39;Words&#39;: [11.836391724073382, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.8941641724252629, 4.1296, False]}],
 [{&#39;Words&#39;: [6.862528629887459, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.17063682392213397, 4.1296, False]}],
 [{&#39;Words&#39;: [6.9725901011308205, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.3887097937082306, 4.1296, False]}],
 [{&#39;Words&#39;: [8.442493725666262, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.4831042963914095, 4.1296, False]}],
 [{&#39;Words&#39;: [3.7997218911182133, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.6631390199841055, 4.1296, False]}],
 [{&#39;Words&#39;: [nan, 12.3212, False]},
  {&#39;Feeltrace&#39;: [2.7198828684742207, 4.1296, False]}],
 [{&#39;Words&#39;: [7.663270611043467, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.09019014958801941, 4.1296, False]}],
 [{&#39;Words&#39;: [2.1829317419270575, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.7470251016767713, 4.1296, False]}],
 [{&#39;Words&#39;: [9.18304693321639, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.2392415220497838, 4.1296, False]}]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h4>Pearson’s correlation<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pearsons_corr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.4278339922605644, 0.016354434278091804),
 (-0.038380217566385766, 0.804639273050901),
 (0.12870160185958213, 0.4477586122212064),
 (0.06494452368750947, 0.6866437028767354),
 (0.20019440184749104, 0.27195041587861246),
 (0.20514233108517874, 0.26002988641099556),
 (0.38170567065931393, 0.008856616352697225),
 (0.37283394344403054, 0.017818209741283043),
 (-0.0035508667789532853, 0.9824211952387047),
 (-0.04936154185393758, 0.7685288820942257),
 (0.37507989332830494, 0.015676468991584567),
 (0.3521731012833589, 0.09145914392721871),
 (0.16243607618703237, 0.5064287410907694),
 (0.010102694230016113, 0.9506660035306832),
 (0.2669588936643751, 0.11550083256908102),
 (-0.029935411905594025, 0.8399348368796864)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pearsons_corr_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pearsons_corr</span><span class="p">]</span>
<span class="n">pearsons_corr_p_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pearsons_corr</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">pearsons_corr_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of correlation values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_103_0.png" src="_images/words-feeltrace_103_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rejected</span><span class="p">,</span> <span class="n">p_adjusted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_corrected</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">pearsons_corr_p_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                                         <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">,</span> 
                                                         <span class="n">is_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">returnsorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rejected H0: %d&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rejected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corrected alpha: %f&#39;</span> <span class="o">%</span> <span class="n">alpha_corrected</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">feeltrace_to_words</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p_adjusted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adujusted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of p-values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rejected H0: 0
Corrected alpha: 0.003125
</pre></div>
</div>
<img alt="_images/words-feeltrace_104_1.png" src="_images/words-feeltrace_104_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Series([], Name: p_number, dtype: int64)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      8
1      9
2     10
3     11
4     12
5     13
6      1
7     14
8     15
9     16
10     2
11     3
12     4
13     5
14     6
15     7
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h4>VAR Model<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>TODO:</p>
<ul class="simple">
<li><p>Summarize VAR model results</p></li>
<li><p>Cluster using VAR coefficients</p></li>
</ul>
</div>
</div>
<div class="section" id="transitions">
<h3>Transitions<a class="headerlink" href="#transitions" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>

<span class="n">n_windows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">granger_p_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stationarity</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cointegration_p_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pearsons_corr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">var_models</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="p">(</span><span class="n">p_words</span><span class="p">,</span> <span class="n">p_feeltrace</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words_list</span><span class="p">,</span> <span class="n">feeltrace_list</span><span class="p">):</span>
    <span class="p">[</span><span class="n">p_words</span><span class="p">,</span> <span class="n">p_feeltrace</span><span class="p">]</span> <span class="o">=</span> <span class="n">prepare_data</span><span class="p">(</span><span class="n">p_words</span><span class="p">,</span> <span class="n">p_feeltrace</span><span class="p">)</span>
    
    <span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Words&#39;</span><span class="p">:</span> <span class="n">sampling_frequency</span><span class="p">(</span><span class="n">p_words</span><span class="p">),</span> 
               <span class="s1">&#39;Feeltrace&#39;</span><span class="p">:</span> <span class="n">sampling_frequency</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">),</span>
               <span class="s1">&#39;p_number&#39;</span><span class="p">:</span> <span class="n">p_feeltrace</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
              <span class="p">})</span>
    
    <span class="p">[</span><span class="n">idxs</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_indexes</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">,</span> <span class="n">p_words</span><span class="p">)</span>
    <span class="n">feeltrace_timestamps</span> <span class="o">=</span> <span class="n">get_feeltrace_timestamps</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">)</span>
    
    <span class="c1"># make sure both timestamps are the same length</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feeltrace_timestamps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Timestamps</span><span class="p">))</span>
    
    <span class="n">n_windows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;p_number&#39;</span><span class="p">:</span> <span class="n">p_words</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;n_windows&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">feeltrace_timestamps</span><span class="p">)})</span>
    
    <span class="n">p_feeltrace_agg_mean</span> <span class="o">=</span> <span class="n">aggregate_mean</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">)</span>
    
    <span class="c1"># make sure both feeltrace and interview series are the same size</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_feeltrace_agg_mean</span><span class="o">.</span><span class="n">Feeltrace</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Values</span><span class="p">))</span>
    
    <span class="n">p_feeltrace_agg_slope</span> <span class="o">=</span> <span class="n">aggregate_slope</span><span class="p">(</span><span class="n">p_feeltrace</span><span class="p">,</span> <span class="n">idxs</span><span class="p">)</span>
    
    <span class="c1"># make sure both feeltrace and interview series are the same size</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p_feeltrace_agg_slope</span><span class="o">.</span><span class="n">Feeltrace</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Values</span><span class="p">))</span>
    
    <span class="n">p_feeltrace_agg_mean_slope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">mean_feeltrace_words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_feeltrace_agg_mean</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># middle windows</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">mean_feeltrace_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">p_feeltrace_agg_mean</span><span class="o">.</span><span class="n">Feeltrace</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">],</span> <span class="n">p_feeltrace_agg_mean</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]))</span>

    <span class="n">p_feeltrace_agg_mean_slope</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_feeltrace_words</span>
    <span class="n">p_feeltrace_agg_mean_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamps</span>
    <span class="n">p_feeltrace_agg_mean_slope</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    
    <span class="n">p_words_agg_slope</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">slope_words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># middle windows</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">prev_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indexes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">slope_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">change_direction</span><span class="p">(</span><span class="n">p_words</span><span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">],</span> <span class="n">p_words</span><span class="o">.</span><span class="n">Timestamps</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prev_idx</span><span class="p">:</span><span class="n">idx</span><span class="p">]))</span>

    <span class="n">p_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slope_words</span>
    <span class="n">p_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamps</span>
    <span class="n">p_words_agg_slope</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
    
    <span class="n">p_agg_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Timestamps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_words_agg_slope</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_feeltrace_agg_mean_slope</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="n">maxlag</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># transitions</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">grangers_causation_matrix</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]],</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
            <span class="n">maxlag</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">maxlag</span><span class="o">-=</span><span class="mi">1</span>
            <span class="n">granger_p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grangers_causation_matrix</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]],</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
            <span class="k">break</span>
            
    <span class="n">stationarity</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;p_number&#39;</span><span class="p">:</span> <span class="n">p_feeltrace</span><span class="o">.</span><span class="n">p_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="s1">&#39;Words&#39;</span><span class="p">:</span> <span class="n">adfuller_test</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">]),</span> 
                         <span class="s1">&#39;Feeltrace&#39;</span><span class="p">:</span> <span class="n">adfuller_test</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">])</span>
                        <span class="p">})</span>
    <span class="n">cointegration_p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cointegration_test</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]]))</span>
    <span class="n">pearsons_corr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Words&#39;</span><span class="p">],</span><span class="n">p_agg_data</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">]))</span>
    
    <span class="c1"># The VAR model will be fitted on df_train and then used to forecast the next 4 </span>
    <span class="c1"># observations. These forecasts will be compared against the actuals present in </span>
    <span class="c1"># test data.</span>


    <span class="n">nobs</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span> <span class="o">=</span> <span class="n">p_agg_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">nobs</span><span class="p">],</span> <span class="n">p_agg_data</span><span class="p">[</span><span class="o">-</span><span class="n">nobs</span><span class="p">:]</span>

    <span class="c1"># Check size</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;Words&#39;</span><span class="p">,</span> <span class="s1">&#39;Feeltrace&#39;</span><span class="p">]])</span>

    <span class="n">maxlag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">select_order</span><span class="p">(</span><span class="n">maxlags</span><span class="o">=</span><span class="n">maxlag</span><span class="p">)</span>
            <span class="n">maxlag</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">maxlag</span><span class="o">-=</span><span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">select_order</span><span class="p">(</span><span class="n">maxlags</span><span class="o">=</span><span class="n">maxlag</span><span class="p">)</span>
            <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">maxlag</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="n">var_models</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">model_fitted</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/rubiarg/.virtualenvs/cpsc554x/lib/python3.9/site-packages/statsmodels/tsa/vector_ar/vecm.py:726: RuntimeWarning: invalid value encountered in log
  tmp = np.log(iota - a)[i:]
/Users/rubiarg/.virtualenvs/cpsc554x/lib/python3.9/site-packages/statsmodels/tsa/vector_ar/vecm.py:728: RuntimeWarning: invalid value encountered in log
  lr2[i] = -t * np.log(1 - a[i])
</pre></div>
</div>
</div>
</div>
<p>The number of windows corresponds to the number of words each participant used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">n_windows</span><span class="p">)</span>
<span class="n">n_windows</span><span class="p">[</span><span class="s1">&#39;n_windows&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    16.000000
mean     36.875000
std       7.736278
min      19.000000
25%      32.000000
50%      39.000000
75%      41.000000
max      48.000000
Name: n_windows, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">));</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">n_windows</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;p_number&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;n_windows&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;# of windows&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">n_windows</span><span class="p">[</span><span class="s1">&#39;n_windows&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_112_0.png" src="_images/words-feeltrace_112_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
<span class="n">fs</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Words</th>
      <th>Feeltrace</th>
      <th>p_number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>16.000000</td>
      <td>16.000000</td>
      <td>16.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.049733</td>
      <td>28.679300</td>
      <td>8.500000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.014987</td>
      <td>1.069693</td>
      <td>4.760952</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.021792</td>
      <td>26.036837</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.040096</td>
      <td>28.109933</td>
      <td>4.750000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.045903</td>
      <td>29.072047</td>
      <td>8.500000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.062562</td>
      <td>29.335980</td>
      <td>12.250000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.075233</td>
      <td>30.082116</td>
      <td>16.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fs_long</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="s1">&#39;p_number&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Pass&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Fs&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">));</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Words&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_115_0.png" src="_images/words-feeltrace_115_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">));</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_116_0.png" src="_images/words-feeltrace_116_0.png" />
</div>
</div>
<p>All results in the next sections are ordered according to p_number:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p_number</th>
      <th>n_windows</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8</td>
      <td>31</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9</td>
      <td>44</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10</td>
      <td>37</td>
    </tr>
    <tr>
      <th>3</th>
      <td>11</td>
      <td>41</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12</td>
      <td>32</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13</td>
      <td>32</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>46</td>
    </tr>
    <tr>
      <th>7</th>
      <td>14</td>
      <td>40</td>
    </tr>
    <tr>
      <th>8</th>
      <td>15</td>
      <td>41</td>
    </tr>
    <tr>
      <th>9</th>
      <td>16</td>
      <td>38</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2</td>
      <td>41</td>
    </tr>
    <tr>
      <th>11</th>
      <td>3</td>
      <td>24</td>
    </tr>
    <tr>
      <th>12</th>
      <td>4</td>
      <td>19</td>
    </tr>
    <tr>
      <th>13</th>
      <td>5</td>
      <td>40</td>
    </tr>
    <tr>
      <th>14</th>
      <td>6</td>
      <td>36</td>
    </tr>
    <tr>
      <th>15</th>
      <td>7</td>
      <td>48</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="id5">
<h4>Granger Causality<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>TODO: calculate power / effect size</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_to_feeltrace</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">feeltrace_to_words</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">granger_p_values</span><span class="p">:</span>
    <span class="n">words_to_feeltrace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">Words_x</span><span class="o">.</span><span class="n">Feeltrace_y</span><span class="p">)</span>
    <span class="n">feeltrace_to_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">Feeltrace_x</span><span class="o">.</span><span class="n">Words_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.multitest</span> <span class="kn">import</span> <span class="n">multipletests</span>
<span class="n">rejected</span><span class="p">,</span> <span class="n">p_adjusted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_corrected</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">words_to_feeltrace</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                                         <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">,</span> 
                                                         <span class="n">is_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">returnsorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rejected H0: %d&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rejected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corrected alpha: %f&#39;</span> <span class="o">%</span> <span class="n">alpha_corrected</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">words_to_feeltrace</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p_adjusted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adujusted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of p-values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rejected H0: 8
Corrected alpha: 0.003125
</pre></div>
</div>
<img alt="_images/words-feeltrace_121_1.png" src="_images/words-feeltrace_121_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.multitest</span> <span class="kn">import</span> <span class="n">multipletests</span>
<span class="n">rejected</span><span class="p">,</span> <span class="n">p_adjusted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_corrected</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">feeltrace_to_words</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                                         <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">,</span> 
                                                         <span class="n">is_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">returnsorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rejected H0: %d&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rejected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corrected alpha: %f&#39;</span> <span class="o">%</span> <span class="n">alpha_corrected</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">feeltrace_to_words</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p_adjusted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adujusted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of p-values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rejected H0: 11
Corrected alpha: 0.003125
</pre></div>
</div>
<img alt="_images/words-feeltrace_122_1.png" src="_images/words-feeltrace_122_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1      9
2     10
3     11
4     12
5     13
7     14
8     15
10     2
11     3
12     4
13     5
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      8
6      1
9     16
14     6
15     7
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>Cointegration<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>TODO: summarize</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cointegration_p_values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[{&#39;Words&#39;: [25.090662611093716, 12.3212, True]},
  {&#39;Feeltrace&#39;: [5.576373930313893, 4.1296, True]}],
 [{&#39;Words&#39;: [13.603258915700817, 12.3212, True]},
  {&#39;Feeltrace&#39;: [6.276792850899008, 4.1296, True]}],
 [{&#39;Words&#39;: [9.379655735708436, 12.3212, False]},
  {&#39;Feeltrace&#39;: [0.19573343693180334, 4.1296, False]}],
 [{&#39;Words&#39;: [11.65595996186797, 12.3212, False]},
  {&#39;Feeltrace&#39;: [1.9116588301250044, 4.1296, False]}],
 [{&#39;Words&#39;: [9.111958373184791, 12.3212, False]},
  {&#39;Feeltrace&#39;: [1.1524863548082218, 4.1296, False]}],
 [{&#39;Words&#39;: [17.78696696048187, 12.3212, True]},
  {&#39;Feeltrace&#39;: [2.973484719112668, 4.1296, False]}],
 [{&#39;Words&#39;: [19.34003040400524, 12.3212, True]},
  {&#39;Feeltrace&#39;: [5.4733836576333665, 4.1296, True]}],
 [{&#39;Words&#39;: [15.928669428541928, 12.3212, True]},
  {&#39;Feeltrace&#39;: [3.5248468516296514, 4.1296, False]}],
 [{&#39;Words&#39;: [16.968590425296398, 12.3212, True]},
  {&#39;Feeltrace&#39;: [3.8884005773847585, 4.1296, False]}],
 [{&#39;Words&#39;: [24.97404578313827, 12.3212, True]},
  {&#39;Feeltrace&#39;: [0.1470102284020976, 4.1296, False]}],
 [{&#39;Words&#39;: [19.92525956453225, 12.3212, True]},
  {&#39;Feeltrace&#39;: [4.567203219379405, 4.1296, True]}],
 [{&#39;Words&#39;: [15.525733112141777, 12.3212, True]},
  {&#39;Feeltrace&#39;: [0.7777883788159, 4.1296, False]}],
 [{&#39;Words&#39;: [nan, 12.3212, False]},
  {&#39;Feeltrace&#39;: [413.2105857201967, 4.1296, True]}],
 [{&#39;Words&#39;: [16.631914435095652, 12.3212, True]},
  {&#39;Feeltrace&#39;: [5.618310470411359, 4.1296, True]}],
 [{&#39;Words&#39;: [18.87596398656086, 12.3212, True]},
  {&#39;Feeltrace&#39;: [6.859219162299845, 4.1296, True]}],
 [{&#39;Words&#39;: [18.395154517219947, 12.3212, True]},
  {&#39;Feeltrace&#39;: [8.452353637903613, 4.1296, True]}]]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h4>Pearson’s correlation<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pearsons_corr_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pearsons_corr</span><span class="p">]</span>
<span class="n">pearsons_corr_p_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pearsons_corr</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">pearsons_corr_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rho&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of correlation values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_129_0.png" src="_images/words-feeltrace_129_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rejected</span><span class="p">,</span> <span class="n">p_adjusted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha_corrected</span> <span class="o">=</span> <span class="n">multipletests</span><span class="p">(</span><span class="n">pearsons_corr_p_values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                                         <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">,</span> 
                                                         <span class="n">is_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">returnsorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rejected H0: %d&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rejected</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Corrected alpha: %f&#39;</span> <span class="o">%</span> <span class="n">alpha_corrected</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">feeltrace_to_words</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">p_adjusted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adujusted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of p-values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rejected H0: 0
Corrected alpha: 0.003125
</pre></div>
</div>
<img alt="_images/words-feeltrace_130_1.png" src="_images/words-feeltrace_130_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Series([], Name: p_number, dtype: int64)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_windows</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_adjusted</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0      8
1      9
2     10
3     11
4     12
5     13
6      1
7     14
8     15
9     16
10     2
11     3
12     4
13     5
14     6
15     7
Name: p_number, dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id8">
<h4>VAR Model<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>TODO:</p>
<ul class="simple">
<li><p>Summarize VAR model results</p></li>
<li><p>Cluster using VAR coefficients</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="emotion-dynamics-analysis">
<h2>Emotion dynamics analysis<a class="headerlink" href="#emotion-dynamics-analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-emotion-dynamics-features">
<h3>Defining emotion dynamics features<a class="headerlink" href="#defining-emotion-dynamics-features" title="Permalink to this headline">¶</a></h3>
<p>Refer to <em>Houben M, Van Den Noortgate W, Kuppens P. The relation between short-term emotion dynamics and psychological well-being: A meta-analysis. Psychological bulletin. 2015 Jul;141(4):901.</em></p>
<ul class="simple">
<li><p><strong>Emotional inertia:</strong> refers to how well the intensity of an emotional state can be predicted from the emotional state at a previous moment.</p></li>
<li><p><strong>Emotional instability:</strong> refers to the magnitude of emotional changes from one moment to the next. An individual characterized by high levels of instability experiences larger emotional shifts from one moment to the next, resulting in a more unstable emotional life.</p></li>
<li><p><strong>Emotional variability:</strong> refers to the range or amplitude of someone’s emotional states across time. An individual characterized by higher levels of emotional variability experiences emotions that reach more extreme levels and shows larger emotional deviations from his or her average emotional level</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EmotionDynamics</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Fs</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Fs</span><span class="o">*</span><span class="n">interval</span><span class="o">*</span><span class="mf">1e-1</span><span class="p">)</span> <span class="c1"># feeltrace sampling rate x 300 ms</span>

    <span class="k">def</span> <span class="nf">emotional_variability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">emotional_instability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># MSSD</span>

    <span class="k">def</span> <span class="nf">emotional_inertia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lag</span>
        <span class="k">return</span> <span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">lag</span><span class="p">)[</span><span class="n">lag</span><span class="p">]</span> <span class="c1"># Autocorrelation</span>
    
    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Inertia&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emotional_inertia</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Instability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emotional_instability</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;Variability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emotional_variability</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parameters</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ED</span> <span class="o">=</span> <span class="n">EmotionDynamics</span><span class="p">(</span><span class="n">Fs</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ED</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">(</span><span class="n">p10_words</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Inertia&#39;: -0.058245294276545984,
 &#39;Instability&#39;: 0.11847916666666665,
 &#39;Variability&#39;: 0.23778154351203037}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">words_list</span><span class="p">:</span>
    <span class="n">calibrated_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subject</span><span class="p">[</span><span class="s1">&#39;Values&#39;</span><span class="p">])</span>
    <span class="n">ed</span> <span class="o">=</span> <span class="n">ED</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">(</span><span class="n">calibrated_values</span><span class="p">)</span>
    <span class="n">ed</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ed</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;interview&#39;</span>
    <span class="n">words_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
<span class="n">words_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">words_data</span><span class="p">)</span>
<span class="n">words_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inertia</th>
      <th>Instability</th>
      <th>Variability</th>
      <th>p_number</th>
      <th>pass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.058245</td>
      <td>4739.166667</td>
      <td>47.556309</td>
      <td>10</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.037667</td>
      <td>4309.883721</td>
      <td>45.126086</td>
      <td>12</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.042847</td>
      <td>4868.750000</td>
      <td>49.910073</td>
      <td>13</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.182514</td>
      <td>2575.000000</td>
      <td>33.046305</td>
      <td>15</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.240929</td>
      <td>2970.967742</td>
      <td>43.546121</td>
      <td>17</td>
      <td>interview</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ED</span> <span class="o">=</span> <span class="n">EmotionDynamics</span><span class="p">(</span><span class="n">Fs</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">feeltrace_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">feeltrace_list</span><span class="p">:</span>
    <span class="n">feeltrace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subject</span><span class="p">[</span><span class="s1">&#39;Feeltrace&#39;</span><span class="p">])</span>
    <span class="n">ed</span> <span class="o">=</span> <span class="n">ED</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">(</span><span class="n">feeltrace</span><span class="p">)</span>
    <span class="n">ed</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ed</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;feeltrace&#39;</span>
    <span class="n">feeltrace_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ed</span><span class="p">)</span>
    
<span class="n">feeltrace_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feeltrace_data</span><span class="p">)</span>
<span class="n">feeltrace_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inertia</th>
      <th>Instability</th>
      <th>Variability</th>
      <th>p_number</th>
      <th>pass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.017359</td>
      <td>0.593234</td>
      <td>32.349176</td>
      <td>10</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.127506</td>
      <td>1.278632</td>
      <td>49.077727</td>
      <td>12</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.111697</td>
      <td>0.951712</td>
      <td>38.263004</td>
      <td>13</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.087622</td>
      <td>1.989445</td>
      <td>40.816129</td>
      <td>15</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.005488</td>
      <td>0.761333</td>
      <td>42.022961</td>
      <td>17</td>
      <td>feeltrace</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">words_data</span><span class="p">,</span> <span class="n">feeltrace_data</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inertia</th>
      <th>Instability</th>
      <th>Variability</th>
      <th>p_number</th>
      <th>pass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.058245</td>
      <td>4739.166667</td>
      <td>47.556309</td>
      <td>10</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.037667</td>
      <td>4309.883721</td>
      <td>45.126086</td>
      <td>12</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.042847</td>
      <td>4868.750000</td>
      <td>49.910073</td>
      <td>13</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.182514</td>
      <td>2575.000000</td>
      <td>33.046305</td>
      <td>15</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.240929</td>
      <td>2970.967742</td>
      <td>43.546121</td>
      <td>17</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.205085</td>
      <td>2337.096774</td>
      <td>38.247434</td>
      <td>19</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.079935</td>
      <td>2387.777778</td>
      <td>36.376685</td>
      <td>2</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.060902</td>
      <td>3267.307692</td>
      <td>39.285613</td>
      <td>20</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.079603</td>
      <td>2957.500000</td>
      <td>37.608064</td>
      <td>22</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.009257</td>
      <td>3268.243243</td>
      <td>40.209157</td>
      <td>23</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.032880</td>
      <td>3156.875000</td>
      <td>38.628326</td>
      <td>4</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-0.202814</td>
      <td>5553.260870</td>
      <td>47.484921</td>
      <td>5</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-0.005982</td>
      <td>2858.333333</td>
      <td>37.872801</td>
      <td>6</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-0.091160</td>
      <td>5023.076923</td>
      <td>47.378793</td>
      <td>7</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.077677</td>
      <td>1895.714286</td>
      <td>32.055062</td>
      <td>8</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-0.221163</td>
      <td>4615.425532</td>
      <td>43.078049</td>
      <td>9</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.017359</td>
      <td>0.593234</td>
      <td>32.349176</td>
      <td>10</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.127506</td>
      <td>1.278632</td>
      <td>49.077727</td>
      <td>12</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.111697</td>
      <td>0.951712</td>
      <td>38.263004</td>
      <td>13</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.087622</td>
      <td>1.989445</td>
      <td>40.816129</td>
      <td>15</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>20</th>
      <td>-0.005488</td>
      <td>0.761333</td>
      <td>42.022961</td>
      <td>17</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.012039</td>
      <td>1.315396</td>
      <td>39.632455</td>
      <td>19</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.067442</td>
      <td>0.714600</td>
      <td>39.557379</td>
      <td>2</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.288932</td>
      <td>0.922316</td>
      <td>33.193777</td>
      <td>20</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>24</th>
      <td>-0.136392</td>
      <td>1.056519</td>
      <td>38.449633</td>
      <td>22</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.156959</td>
      <td>0.808034</td>
      <td>29.005620</td>
      <td>23</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>26</th>
      <td>0.231364</td>
      <td>0.985158</td>
      <td>48.939746</td>
      <td>4</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>27</th>
      <td>-0.069199</td>
      <td>0.952268</td>
      <td>29.056105</td>
      <td>5</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0.529267</td>
      <td>1.015773</td>
      <td>48.688655</td>
      <td>6</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>29</th>
      <td>-0.058015</td>
      <td>0.796932</td>
      <td>42.722726</td>
      <td>7</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>30</th>
      <td>0.081231</td>
      <td>0.784511</td>
      <td>43.330018</td>
      <td>8</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>31</th>
      <td>0.135203</td>
      <td>0.501430</td>
      <td>27.154791</td>
      <td>9</td>
      <td>feeltrace</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="data-preprocessing-scaling">
<h3>Data preprocessing: scaling<a class="headerlink" href="#data-preprocessing-scaling" title="Permalink to this headline">¶</a></h3>
<p>Standardize features by removing the mean and scaling to unit variance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_feeltrace</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">feeltrace_data</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]])</span>
<span class="n">X_feeltrace</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_feeltrace</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">])</span>
<span class="n">X_feeltrace</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feeltrace_data</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
<span class="n">X_feeltrace</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">feeltrace_data</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span>
<span class="n">X_feeltrace</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inertia</th>
      <th>Instability</th>
      <th>Variability</th>
      <th>p_number</th>
      <th>pass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.527612</td>
      <td>-1.097853</td>
      <td>-0.950685</td>
      <td>10</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.187769</td>
      <td>0.930514</td>
      <td>1.480287</td>
      <td>12</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.085095</td>
      <td>-0.036975</td>
      <td>-0.091295</td>
      <td>13</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.071268</td>
      <td>3.034094</td>
      <td>0.279722</td>
      <td>15</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.675998</td>
      <td>-0.600382</td>
      <td>0.455097</td>
      <td>17</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.562169</td>
      <td>1.039313</td>
      <td>0.107712</td>
      <td>19</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.202338</td>
      <td>-0.738683</td>
      <td>0.096802</td>
      <td>2</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.236198</td>
      <td>-0.123969</td>
      <td>-0.827949</td>
      <td>20</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-1.526199</td>
      <td>0.273190</td>
      <td>-0.064174</td>
      <td>22</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.379056</td>
      <td>-0.462175</td>
      <td>-1.436566</td>
      <td>23</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.862305</td>
      <td>0.062007</td>
      <td>1.460235</td>
      <td>4</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-1.089790</td>
      <td>-0.035328</td>
      <td>-1.429230</td>
      <td>5</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2.797121</td>
      <td>0.152608</td>
      <td>1.423747</td>
      <td>6</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-1.017152</td>
      <td>-0.495032</td>
      <td>0.556786</td>
      <td>7</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.112779</td>
      <td>-0.531789</td>
      <td>0.645037</td>
      <td>8</td>
      <td>feeltrace</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.237761</td>
      <td>-1.369540</td>
      <td>-1.705526</td>
      <td>9</td>
      <td>feeltrace</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_words</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">words_data</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]])</span>
<span class="n">X_words</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_words</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">])</span>
<span class="n">X_words</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words_data</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
<span class="n">X_words</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words_data</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span>
<span class="n">X_words</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inertia</th>
      <th>Instability</th>
      <th>Variability</th>
      <th>p_number</th>
      <th>pass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.303855</td>
      <td>1.091102</td>
      <td>1.239767</td>
      <td>10</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.141110</td>
      <td>0.697543</td>
      <td>0.773963</td>
      <td>12</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.495656</td>
      <td>1.209901</td>
      <td>1.690916</td>
      <td>13</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.286661</td>
      <td>-0.892967</td>
      <td>-1.541383</td>
      <td>15</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.062228</td>
      <td>-0.529951</td>
      <td>0.471130</td>
      <td>17</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.778744</td>
      <td>-1.111073</td>
      <td>-0.544476</td>
      <td>19</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.788972</td>
      <td>-1.064609</td>
      <td>-0.903045</td>
      <td>2</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.324868</td>
      <td>-0.258272</td>
      <td>-0.345487</td>
      <td>20</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.472769</td>
      <td>-0.542298</td>
      <td>-0.667025</td>
      <td>22</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.230004</td>
      <td>-0.257414</td>
      <td>-0.168470</td>
      <td>23</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.103245</td>
      <td>-0.359515</td>
      <td>-0.471470</td>
      <td>4</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-1.447203</td>
      <td>1.837448</td>
      <td>1.226084</td>
      <td>5</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.109482</td>
      <td>-0.633212</td>
      <td>-0.616283</td>
      <td>6</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-0.564167</td>
      <td>1.351385</td>
      <td>1.205742</td>
      <td>7</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.771117</td>
      <td>-1.515724</td>
      <td>-1.731376</td>
      <td>8</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>15</th>
      <td>-1.592325</td>
      <td>0.977658</td>
      <td>0.381414</td>
      <td>9</td>
      <td>interview</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_words</span><span class="p">,</span> <span class="n">X_feeltrace</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pairplot-analysis">
<h3>Pairplot analysis<a class="headerlink" href="#pairplot-analysis" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_147_0.png" src="_images/words-feeltrace_147_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">abs</span><span class="p">(</span><span class="n">X_feeltrace</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]]</span> <span class="o">-</span> <span class="n">X_words</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Inertia</th>
      <th>Instability</th>
      <th>Variability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.223757</td>
      <td>2.188955</td>
      <td>2.190452</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.328879</td>
      <td>0.232971</td>
      <td>0.706323</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.410561</td>
      <td>1.246877</td>
      <td>1.782211</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.215394</td>
      <td>3.927061</td>
      <td>1.821105</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.738226</td>
      <td>0.070431</td>
      <td>0.016032</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2.340913</td>
      <td>2.150386</td>
      <td>0.652188</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.991310</td>
      <td>0.325926</td>
      <td>0.999847</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.561066</td>
      <td>0.134303</td>
      <td>0.482461</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.053430</td>
      <td>0.815489</td>
      <td>0.602851</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.149052</td>
      <td>0.204760</td>
      <td>1.268096</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.965550</td>
      <td>0.421522</td>
      <td>1.931706</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.357413</td>
      <td>1.872777</td>
      <td>2.655314</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2.687639</td>
      <td>0.785820</td>
      <td>2.040030</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.452986</td>
      <td>1.846417</td>
      <td>0.648956</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.883896</td>
      <td>0.983935</td>
      <td>2.376413</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1.830086</td>
      <td>2.347198</td>
      <td>2.086940</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="d-scatterplot">
<h3>3D scatterplot<a class="headerlink" href="#d-scatterplot" title="Permalink to this headline">¶</a></h3>
<p>TODO: color according to labelling pass</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">elev</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span> <span class="n">auto_add_to_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">Inertia</span><span class="p">,</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">Instability</span><span class="p">,</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">Variability</span><span class="p">,</span> 
           <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">nipy_spectral</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">subject</span><span class="p">)</span> <span class="ow">in</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1">#plot each point + it&#39;s index as text above</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">Inertia</span><span class="p">,</span><span class="n">subject</span><span class="o">.</span><span class="n">Instability</span><span class="p">,</span> <span class="n">subject</span><span class="o">.</span><span class="n">Variability</span><span class="p">,</span>  <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> 

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Inertia&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Instability&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Variability&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_151_0.png" src="_images/words-feeltrace_151_0.png" />
</div>
</div>
</div>
<div class="section" id="principal-component-analysis">
<h3>Principal Component Analysis<a class="headerlink" href="#principal-component-analysis" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">decomposition</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">decomposition</span><span class="o">.</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]])</span>
<span class="n">X_PCA</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">X_PCA</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">X_PCA</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">);</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">subject</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span> <span class="c1">#plot each point + it&#39;s index as text above</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">X_PCA</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_PCA</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_153_0.png" src="_images/words-feeltrace_153_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_PCA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_PCA</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">,</span> <span class="s1">&#39;PC2&#39;</span><span class="p">])</span>
<span class="n">X_PCA</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_scaled</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
<span class="n">X_PCA</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_scaled</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span>
<span class="n">X_PCA</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC1</th>
      <th>PC2</th>
      <th>p_number</th>
      <th>pass</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.671090</td>
      <td>0.077657</td>
      <td>10</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.045347</td>
      <td>0.092455</td>
      <td>12</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.899256</td>
      <td>0.974139</td>
      <td>13</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.415254</td>
      <td>-1.680991</td>
      <td>15</td>
      <td>interview</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.473970</td>
      <td>2.128202</td>
      <td>17</td>
      <td>interview</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: fix colors</span>

<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">distance</span>

<span class="n">pass_distance</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">X_PCA</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;p_number&#39;</span><span class="p">):</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">subject_interview</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">subject</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;interview&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">,</span> <span class="s1">&#39;PC2&#39;</span><span class="p">]]</span>
    <span class="n">subject_feeltrace</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">subject</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;feeltrace&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">,</span> <span class="s1">&#39;PC2&#39;</span><span class="p">]]</span>
    <span class="n">pass_distance</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;p_number&#39;</span><span class="p">:</span> <span class="n">subject</span><span class="o">.</span><span class="n">p_number</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Distance&#39;</span><span class="p">:</span> <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">subject_interview</span><span class="p">,</span> <span class="n">subject_feeltrace</span><span class="p">)})</span>

<span class="n">pass_distance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pass_distance</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pass_distance</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Distance&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_155_0.png" src="_images/words-feeltrace_155_0.png" />
</div>
</div>
</div>
<div class="section" id="repeated-measures-analysis">
<h3>Repeated Measures Analysis<a class="headerlink" href="#repeated-measures-analysis" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_scaled</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;scaled_ed_per_pass.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>See Jamovi results.</p>
</div>
<div class="section" id="gaussian-mixture-model">
<h3>Gaussian Mixture Model<a class="headerlink" href="#gaussian-mixture-model" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">================================</span>
<span class="sd">Gaussian Mixture Model Selection</span>
<span class="sd">================================</span>

<span class="sd">Gaussian Mixture Models using information-theoretic criteria (BIC).</span>
<span class="sd">Model selection concerns both the covariance type and the number of components in the model.</span>
<span class="sd">Unlike Bayesian procedures, such inferences are prior-free.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">itertools</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">mixture</span>

<span class="n">lowest_bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">infty</span>
<span class="n">bic</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">n_components_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">cv_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spherical&quot;</span><span class="p">,</span> <span class="s2">&quot;tied&quot;</span><span class="p">,</span> <span class="s2">&quot;diag&quot;</span><span class="p">,</span> <span class="s2">&quot;full&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">cv_type</span> <span class="ow">in</span> <span class="n">cv_types</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n_components</span> <span class="ow">in</span> <span class="n">n_components_range</span><span class="p">:</span>
        <span class="c1"># Fit a Gaussian mixture with EM</span>
        <span class="n">gmm</span> <span class="o">=</span> <span class="n">mixture</span><span class="o">.</span><span class="n">GaussianMixture</span><span class="p">(</span>
            <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">covariance_type</span><span class="o">=</span><span class="n">cv_type</span>
        <span class="p">)</span>
        <span class="n">gmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]])</span>
        <span class="n">bic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gmm</span><span class="o">.</span><span class="n">bic</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]]))</span>
        <span class="k">if</span> <span class="n">bic</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lowest_bic</span><span class="p">:</span>
            <span class="n">lowest_bic</span> <span class="o">=</span> <span class="n">bic</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">best_gmm</span> <span class="o">=</span> <span class="n">gmm</span>

<span class="n">bic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bic</span><span class="p">)</span>
<span class="n">color_iter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:green&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:red&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:brown&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:pink&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:gray&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:olive&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:cyan&#39;</span><span class="p">])</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">best_gmm</span>
<span class="n">bars</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Plot the BIC scores</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">spl</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">cv_type</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cv_types</span><span class="p">,</span> <span class="n">color_iter</span><span class="p">)):</span>
    <span class="n">xpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n_components_range</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">bars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">xpos</span><span class="p">,</span>
            <span class="n">bic</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_components_range</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_components_range</span><span class="p">)],</span>
            <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">n_components_range</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">bic</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.01</span> <span class="o">-</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">bic</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">bic</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;BIC score per model&quot;</span><span class="p">)</span>
<span class="n">xpos</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">bic</span><span class="o">.</span><span class="n">argmin</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_components_range</span><span class="p">))</span>
    <span class="o">+</span> <span class="mf">0.65</span>
    <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">bic</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_components_range</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">bic</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.97</span> <span class="o">+</span> <span class="mf">0.03</span> <span class="o">*</span> <span class="n">bic</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">spl</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of components&quot;</span><span class="p">)</span>
<span class="n">spl</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">],</span> <span class="n">cv_types</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_160_0.png" src="_images/words-feeltrace_160_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: Fix legend</span>

<span class="c1"># Plot the winner</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">elev</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span> <span class="n">auto_add_to_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">Y_</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[[</span><span class="s1">&#39;Inertia&#39;</span><span class="p">,</span> <span class="s1">&#39;Instability&#39;</span><span class="p">,</span> <span class="s1">&#39;Variability&#39;</span><span class="p">]])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span> <span class="n">color_iter</span><span class="p">)):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Y_</span> <span class="o">==</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">Inertia</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Y_</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">Instability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Y_</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span> 
               <span class="n">X_scaled</span><span class="o">.</span><span class="n">Variability</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Y_</span> <span class="o">==</span> <span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">subject</span><span class="p">)</span> <span class="ow">in</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> <span class="c1">#plot each point + it&#39;s index as text above</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="s1">&#39;p_number&#39;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">Inertia</span><span class="p">,</span><span class="n">subject</span><span class="o">.</span><span class="n">Instability</span><span class="p">,</span> <span class="n">subject</span><span class="o">.</span><span class="n">Variability</span><span class="p">,</span>  <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> 
    
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">means_</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Inertia&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Instability&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Variability&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Selected GMM: </span><span class="si">{</span><span class="n">best_gmm</span><span class="o">.</span><span class="n">covariance_type</span><span class="si">}</span><span class="s2"> model, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">best_gmm</span><span class="o">.</span><span class="n">n_components</span><span class="si">}</span><span class="s2"> components&quot;</span>
<span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/words-feeltrace_161_0.png" src="_images/words-feeltrace_161_0.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="calibrated-words.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Calibrated words self-report analysis</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Rubia Guerra<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>